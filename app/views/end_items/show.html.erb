<% if end_user_signed_in? %>
	<%= render 'end_header/login_header' %>
<% else %>
	<%= render 'end_header/not_login_header' %>
<% end %>

<div class="container n_end_items_show_container">
	<div class="row">
		<div class="col-xs-12">
			<div class="n_end_items_show_title">商品詳細</div>
		</div>
	</div>
	<div class="row">
		<div class="col-xs-4">
			<% if @item.stock > 0 && @item.sale_condition == "販売中" %>
				<div><%= attachment_image_tag @item, :item_image, :fill, 300, 300, format: "jpeg" %></div>
			<% elsif @item.sale_condition == "販売停止中" %>
				<div class="n_end_items_show_sold_out_img">
					<%= attachment_image_tag @item, :item_image, :fill, 300, 300, format: "jpeg" %>
					<div class="n_sold_out_txt">販売停止中</div>
				</div>
			<% elsif @item.stock == 0 %>
				<div class="n_end_items_show_sold_out_img">
					<%= attachment_image_tag @item, :item_image, :fill, 300, 300, format: "jpeg" %>
					<div class="n_sold_out_txt">売り切れ</div>
				</div>
			<% end %>
		</div>
		<div class="col-xs-4">
			<div class="n_end_items_show_item_name"><%= @item.item_name %></div>
			<div class="n_end_items_show_artist_name"><%= @item.artist.artist_name %></div>
			<div class="n_end_items_show_sale_condition"><%= @item.sale_condition %></div>
			<div class="n_end_items_show_stock">
				在庫数:
				<span><%= @item.stock %></span>
			</div>
		</div>
		<div class="col-xs-4">
			<div class="n_end_items_show_price">
				<div class="n_end_items_show_price_tag">価格(税込)</div>
				<span class="n_end_items_show_price_number">¥<%= (BigDecimal(@item.price) * BigDecimal(@tax_rate)).ceil.to_s(:delimited) %></span>
			</div>
			<% if @item.stock > 0 && @item.sale_condition == "販売中" %>
				<div>
					<%= form_with url: add_end_cart_items_path, method: :post, local: true do |f| %>
						<%= f.hidden_field :item_id, :value => @item.id %>
						<%= f.label :purchase_quantity, "数量:" %>
						<%= f.text_field :purchase_quantity %><br>
						<%= f.submit "この商品をカートに入れる" %>
					<% end %>
				</div>
			<% end %>
			<% if end_user_signed_in? %>
				<%= render "end_favorites/favorite_links", item: @item %>
			<% end %>
		</div>
	</div>
	<div class="row">
		<div class="col-xs-6 n_end_items_show_genre">
			<table class="table table-hover table-bordered">
				<tbody>
					<tr class="info">
						<td>ジャンル</td>
						<td><%= @item.genre.genre_name %></td>
					</tr>
				</tbody>
			</table>
		</div>
		<div class="col-xs-6 n_end_items_show_label">
			<table class="table table-hover">
				<tbody>
					<tr class="info">
						<td>レーベル</td>
						<td><%= @item.label.label_name %></td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>
	<div class="row">
		<div class="col-xs-12">
			<h3>CD収録曲</h3>
		</div>
	</div>
	<div class="row">
		<div class="col-xs-12">
			<% @item.discs.order("disc_number").each do |disc| %>
				<table class="table table-hover">
					<thead>
						<tr>
							<th>
								ディスク<%= disc.disc_number %>
				<% disc.musics.order("music_order").each do |music| %>
					<tbody>
						<tr class="success">
							<th><%= music.music_order %></th>
							<td><%= music.music_name %></td>
				<% end %>
						</tr>
					</tbody>
							</th>
						</tr>
					</thead>
				</table>
			<% end %>
		</div>
	</div>
</div>
